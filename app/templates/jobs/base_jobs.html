{% extends 'base.html' %}


{% block modals %}
<!-- Modal -->
<div class="modal fade" id="jobModal" tabindex="-1" aria-labelledby="jobModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="jobModalLabel">Add New job</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <!-- Form to Add job -->
            <form id="jobForm" method="post" action="{{ url_for('jobs.create_job') }}" enctype="multipart/form-data" class="needs-validation" novalidate>
                    <div class="mb-3">
                        <label for="jobtitle" class="form-label">Job Title</label>
                        <input type="text" class="form-control" id="jobtitle" name="jobtitle" required>
                        <div class="invalid-feedback">
                            Please provide a job title.
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Job Description</label>
                        <textarea class="form-control is-invalid" id="description" name="description" rows="10" required></textarea>
                    </div>
        
                    <div class="mb-3">
                        <label for="joblocation" class="form-label">Job Location</label> 
                        <input type="text" class="form-control" id="joblocation" name="joblocation" required>
                    </div>
        
                    <div class="mb-3">
                        <label for="jobsalary" class="form-label">Salary</label> 
                        <input type="text" class="form-control" id="jobsalary" name="jobsalary" required>
                    </div>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Publish Job</button>
            </form>
        </div>
      </div>
    </div>
  </div>



<!-- Edit Job Modal -->
<div class="modal fade" id="editJobModal" tabindex="-1" aria-labelledby="editJobModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editJobModalLabel">Edit Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editJobForm" action="{{ url_for('jobs.update_job')}}" method="post">
                    <input type="hidden" id="editJobId" name="editJobId">
                    <div class="mb-3">
                        <label for="editJobTitle" class="form-label">Job Title</label>
                        <input type="text" class="form-control" id="editJobTitle" name="editJobTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="editJobDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="editJobDescription" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="editJobLocation" class="form-label">Location</label>
                        <input type="text" class="form-control" id="editJobLocation" name="editJobLocation" required>
                    </div>
                    <div class="mb-3">
                        <label for="editJobSalary" class="form-label">Salary</label>
                        <input type="number" class="form-control" id="editJobSalary" name="editJobSalary" required>
                    </div>
                    <input type="hidden" name="job-id" id="job-id" value=""> 
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- Delete job modal -->
<div class="modal fade" id="deleteJobModal" tabindex="-1" aria-labelledby="deleteJobModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteJobModalLabel">Delete Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editJobForm" action="{{ url_for('jobs.delete_job')}}" method="post">
                <input type="hidden" id="delJobId" name="delJobId">
                <div class="modal-body">
                    <p>Are you sure you want to delete this job?</p>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteJob">Delete</button>
            </div>
        </div>
    </div>
</div>


{% endblock %}


{% block pagination %}
<!-- without the sort and order by args -->
    {% if total_count > 10 %}
    <nav aria-label="Jobs pagination" class="mt-4">
        <ul class="pagination justify-content-start">
            <!-- Previous Button -->
            {% if pagination.has_prev %}
            <li class="page-item">
                {% if request.args.get('search') %}
                <a class="page-link" href="{{ url_for('frontend.jobs', page=pagination.prev_num, search=request.args.get('search', '')) }}" tabindex="-1">Previous</a>
                {% else %}
                <a class="page-link" href="{{ url_for('frontend.jobs', page=pagination.prev_num) }}" tabindex="-1">Previous</a>
                {% endif %}
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1">Previous</a>
            </li>
            {% endif %}

            <!-- Page Numbers -->
            {% set window_size = 1 %}
            {% for page_num in range(1, pagination.pages + 1) %}
                {% if page_num == 1 or 
                    page_num == pagination.pages or 
                    (page_num >= pagination.page - window_size and 
                    page_num <= pagination.page + window_size) %}
                    
                    <li class="page-item {% if page_num == pagination.page %} active{% endif %}">
                        {% if request.args.get('search') %}
                        <a class="page-link" href="{{ url_for('frontend.jobs',page=page_num, search=request.args.get('search', '')) }}">{{ page_num }}</a>
                        {% else %}
                        <a class="page-link" href="{{ url_for('frontend.jobs',page=page_num)}}">{{ page_num }}</a>
                        {% endif %}
                    </li>
                {% elif page_num == pagination.page - window_size - 1 or 
                        page_num == pagination.page + window_size + 1 %}
                    <li class="page-item disabled">
                        <a class="page-link" href="#">...</a>
                    </li>
                {% endif %}
            {% endfor %}

            <!-- Next Button -->
            {% if pagination.has_next %}
            <li class="page-item">
                {% if request.args.get('search') %}
                <a class="page-link" href="{{ url_for('frontend.jobs', page=pagination.next_num, search=request.args.get('search', '')) }}">Next</a>
                {% else %}
                <a class="page-link" href="{{ url_for('frontend.jobs', page=pagination.next_num) }}">Next</a>
                {% endif %}
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" href="#">Next</a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
{% endblock pagination %}



{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
    // Handle Edit Job Modal
    const editModal = document.getElementById('editJobModal');
    if (editModal) {
        editModal.addEventListener('show.bs.modal', function(event) {
            const button = event.relatedTarget;
            const jobId = button.getAttribute('data-job-id');
            const form = editModal.querySelector('#editJobForm');
            
            // Update form action with correct job_id
            form.action = form.action.replace('job_id=0', 'job_id=' + jobId);
            
            // Update hidden input
            document.getElementById('job-id').value = jobId;
            
            // Fetch job data and populate form
            fetch(`/jobs/api/${jobId}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('editJobTitle').value = data.title;
                    document.getElementById('editJobDescription').value = data.description;
                    document.getElementById('editJobLocation').value = data.location;
                    document.getElementById('editJobSalary').value = data.salary;
                });
        });
    }

    // Handle Delete Job Modal
    const deleteModal = document.getElementById('deleteJobModal');
    if (deleteModal) {
        deleteModal.addEventListener('show.bs.modal', function(event) {
            const button = event.relatedTarget;
            const jobId = button.getAttribute('data-job-id');
            const deleteForm = deleteModal.querySelector('form');
            deleteForm.action = `/jobs/delete/${jobId}`;
        });
    }
});
</script>
{% endblock %}